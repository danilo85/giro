<!DOCTYPE html>
<html>
<head>
    <title>Test Batch Download</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>Test Batch Download</h1>
    <button id="testBtn">Test Download Batch</button>
    <div id="result"></div>

    <script>
        document.getElementById('testBtn').addEventListener('click', function() {
            console.log('Testando download em lote...');
            
            // Primeiro, obter o token CSRF da página de assets
            fetch('/assets')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const csrfToken = doc.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
                    
                    console.log('CSRF Token encontrado:', csrfToken);
                    
                    if (!csrfToken) {
                        document.getElementById('result').innerHTML = '<div style="color: red;">Token CSRF não encontrado!</div>';
                        return;
                    }
                    
                    // Criar formulário para teste
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/assets/download-batch';
                    form.target = '_blank';
                    form.style.display = 'none';
                    
                    // Adicionar token CSRF
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = '_token';
                    csrfInput.value = csrfToken;
                    form.appendChild(csrfInput);
                    
                    // Adicionar IDs de teste (IDs válidos do banco de dados)
                    const testIds = ['13e679a2-ecff-4456-9258-9a572f9fc05e', '4c2d1911-0fee-4fb6-80b3-0826c4e04e9d']; // IDs válidos
                    testIds.forEach((id, index) => {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = `asset_ids[${index}]`;
                        input.value = id;
                        form.appendChild(input);
                    });
                    
                    // Adicionar ao DOM e submeter
                    document.body.appendChild(form);
                    console.log('Submetendo formulário...');
                    form.submit();
                    
                    // Remover formulário após submissão
                    setTimeout(() => {
                        document.body.removeChild(form);
                    }, 1000);
                    
                    document.getElementById('result').innerHTML = '<div style="color: green;">Formulário submetido! Verifique se uma nova guia foi aberta.</div>';
                })
                .catch(error => {
                    console.error('Erro:', error);
                    document.getElementById('result').innerHTML = '<div style="color: red;">Erro: ' + error.message + '</div>';
                });
        });
    </script>
</body>
</html>