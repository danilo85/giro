<!DOCTYPE html>
<html>
<head>
    <title>Test Upload Debug</title>
    <meta name="csrf-token" content="test-token">
</head>
<body>
    <h1>Test Upload Debug</h1>
    <input type="file" id="test-file" multiple>
    <button onclick="testUpload()">Test Upload</button>
    <div id="result"></div>

    <script>
        async function testUpload() {
            const fileInput = document.getElementById('test-file');
            const resultDiv = document.getElementById('result');
            
            if (fileInput.files.length === 0) {
                resultDiv.innerHTML = '<p style="color: red;">Please select a file first</p>';
                return;
            }
            
            const formData = new FormData();
            for (let i = 0; i < fileInput.files.length; i++) {
                formData.append('files[]', fileInput.files[i]);
            }
            
            try {
                console.log('🚀 Starting test upload...');
                const response = await fetch('/assets/upload', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRF-TOKEN': 'test-token'
                    }
                });
                
                console.log('📊 Response status:', response.status);
                console.log('📊 Response ok:', response.ok);
                console.log('📊 Response headers:', response.headers);
                
                const responseText = await response.text();
                console.log('📄 Raw response:', responseText);
                
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                    console.log('📋 Parsed JSON:', responseData);
                } catch (e) {
                    console.error('❌ JSON parse error:', e);
                    responseData = { error: 'Invalid JSON response', raw: responseText };
                }
                
                resultDiv.innerHTML = `
                    <h3>Response Status: ${response.status}</h3>
                    <h3>Response OK: ${response.ok}</h3>
                    <h3>Raw Response:</h3>
                    <pre>${responseText}</pre>
                    <h3>Parsed Data:</h3>
                    <pre>${JSON.stringify(responseData, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('🚨 Upload error:', error);
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>